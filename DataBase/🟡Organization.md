Системы управления базой данных имеет сложную структуру хранения этих самых данных для обеспечения высокой производительности доступа к ним. Данные разбиваются на кластеры, базы данных, таблицы и страницы таблиц.

**==Claster==**. При первом запуске дистрибутива системы управления базы данных, она создает кластер. Кластер представляет собой несколько баз данных, управляемые из под одной инстанции сервера. Файлы данных кластера лежат в директории `data`.

Директория `data` находится по адресу переменной окружения `PGDATA`. Данная директория содержит директории со всеми базами данных кластера, а также множество вспомогательных данных для обеспечения работы кластера.

**==DataBase==**. Для каждой базы данных в директории `data` есть своя отдельная поддиректория. Содержащая вспомогательные файлы и файлы таблицы.

**==HeapFile==**. В директории каждой базы данных, для каждой таблицы и индекса выделяется отдельный файл. Каждый такой файл бьется на сегменты по 1ГБ.

Файл таблицы также называется `HeapFile` и содержит неупорядоченный набор записей таблицы различной длинны. `HeapFile` разбивается на страницы по 8КБ.

Рядом с файлом таблицы лежит файл `FSM(Free Space Map)`и содержащий округленное значение размера страниц. Используется для определения сервером, куда можно сохранить новые данные, исключив беспорядочный поиск свободной страницы.

Файл `FSM` не обновляется при каждом обновлении таблицы, так как при удалении данных они не сразу исчезают из памяти, для работы механизма конкретного доступа.

Также рядом с файлом таблицы лежит файл `VM(visibility map)`, который содержит информацию о содержании на странице строк с пометкой требования перезаписи.

**==HeapFileList==**. Каждый файл таблицы разбивается на страницы по 8КБ. Каждая страница содержит заголовок страницы и строки со всеми заголовками. Если страница содержит значение записи превышающее 8КБ. То такая запись вынужденно перемещается в `TOAST(Oversized Attribute Storage Technique)`, а в страницу ссылка на запись `TOAST`.

---

Для пометки дохлых строк базы данных применяется команда `VACUUME`. Она не возвращает память операционной системе, а лишь помечает строки для перезаписи.
Версия команды `VACUUME FULL` проводит сжатие и дефрагментацию всей таблицы. 

Дефрагментация таблицы происходит очень долго, требует много памяти и берет эксклюзивную блокировку к данным. Во избежание вызова такой команды, нужно периодически вызывать обычный `VACUUME`, чтобы фрагментация не нарастала. 

Также можно вызвать команду `VACUUME ANALYZE`, является комбинацией двух команд, которая после проведения пометки удаляемых данных собирает новую статистику. 
