
Система `Docker` содержит ряд инструментов для монтирования данных. 
Данные в `Docker` могут храниться либо временно, либо постоянно.

Система `Docker` предоставляет контейнерам четыре варианта хранения данных: временное хранение в слое контейнера, временное хранение в оперативной памяти хост машины, постоянное хранение в томах и постоянное хранение с привязкой.

---

В контейнерах `Docker` организовать работу с временными данными можно
двумя способами. По умолчанию файлы, создаваемые приложением в контейнере, сохраняются в слое контейнера. Однако после того как контейнер перестанет существовать, исчезнут и данные, сохранённые таким вот нехитрым способом.

Также для хранения временных файлов в `Docker` можно воспользоваться `tmpfs` монтированием. Этот способ позволяет сохранять временные данные в оперативной памяти хоста. Такой способ намного быстрее других, но работает только на `Linux`.
Это полезно для временного хранения конфиденциальных файлов, которые
вы не хотите сохранять ни на хосте, ни на записываемом уровне контейнера.

---

Существуют два способа, позволяющих сделать срок жизни данных большим срока жизни контейнера. Один из способов заключается в использовании `bindMount`. 
При таком подходе к контейнеру можно присоединить директорию хост машины.
Работать с такой директорией, смогут и процессы, находящиеся за пределами `Docker`. 
Контейнер ссылается на такую директория по ее абсолютному пути на хост машине.

Смонтированные директории очень производительны, но они полагаются на файловую систему хост машины, имеющую определенную структуру каталогов.

![[{1273B6DF-E023-4505-A910-0A83CA41279A}.png]]

---

Том представляет собой файловую систему, которая расположена на хост машине за пределами контейнеров. Созданием и управлением томами занимается `Docker`.

В контейнере том видно как обычный каталог, который мы определяем в `Dockerfile`. Тома могут быть с именами или без, безымянным томам `Docker` сам присвоит имя.

Один том может быть примонтирован одновременно в несколько контейнеров.
Когда никто не использует том, он не удаляется, а продолжает существовать.

С хоста можно монтировать любые файлы, в том числе служебные. Например, сокет `docker`. В результате получится `docker-in-docker`: один контейнер запустится внутри другого. Выглядит как бред, но в некоторых случаях оправдано. Например в `CI/CD`.

Тома являются предпочтительным механизмом для сохранения данных, созданных и используемых контейнерами `Docker`. В то время как `BindMounts` зависят от структуры каталогов `OS`, где располагаются контейнеры, тома полностью управляются `Docker`.

Кроме того, тома часто являются лучшим выбором, чем сохранение данных в доступном для записи слое контейнера, поскольку том не увеличивает размер контейнеров. Том существует за пределами жизненного цикла контейнера.

Тома можно создавать средствами `Docker` или с помощью запросов к `API`.
С помощью команды `VOLUEM` в `Dockerfile` можно автоматически создать том
после запуска контейнера, который уже будет смонтирован по указанному пути. 
Удалять можно только тома, которые не связаны с запущенными контейнерами.

```dockerfile
VOLUME /path
```

```sh
docker volume create —-name <name> // Создание тома через dockerapi
docker volume ls                   // Список существующих томов
docker volume rm <name>            // Удаление тома
docker volume prune                // Удаление всех томов

```

Для добавления тома к контейнеру и в целом для любого вида монтирования, используется флаг `--mount`.  Раньше также был популярен был флаг `--volume`. Изначально этот флаг использовался для самостоятельных контейнеров, а `mount` 
в среде `Docker Swarm`. Однако сейчас `mount` можно использовать и в контейнерах.  
  
Флаг `mount` это единственный механизм, который позволяет работать с сервисами
или указывать параметры драйвера тома. Кроме того, работать с этим флагом проще.  

Главное различие между `mount` и `volume` заключается в том, что при использовании флага `volume` все параметры собирают в одном поле, а в `mount` они разделяются.  

```dockerfile
docker run --mount type=<type>, src=<source>, dst=<path> <image>

type - тип монтирования bind, volume или tmpfs
src — источник монтирования. Для именованных томов это — имя тома.
dst — путь по которому файл или папка монтируется в контейнере.

```