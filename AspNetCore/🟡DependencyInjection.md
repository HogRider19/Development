–í–Ω–µ–¥—Ä–µ–Ω–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π `DependencyInjection`  –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç –ø—Ä–æ—Ü–µ—Å—Å –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–∏—è –≤–Ω–µ—à–Ω–µ–π –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –ø—Ä–æ–≥—Ä–∞–º–º–Ω–æ–º—É –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—É. –Ø–≤–ª—è–µ—Ç—Å—è —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω–æ–π —Ñ–æ—Ä–º–æ–π –∏–Ω–≤–µ—Ä—Å–∏–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è. –¢–∞–∫–∏–µ –æ–±—ä–µ–∫—Ç—ã —Å–≤—è–∑–∞–Ω—ã –º–µ–∂–¥—É —Å–æ–±–æ–π —á–µ—Ä–µ–∑ –∞–±—Å—Ç—Ä–∞–∫—Ü–∏–∏, –Ω–∞–ø—Ä–∏–º–µ—Ä, —á–µ—Ä–µ–∑ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã, —á—Ç–æ –¥–µ–ª–∞–µ—Ç –≤—Å—é —Å–∏—Å—Ç–µ–º—É –±–æ–ª–µ–µ –≥–∏–±–∫–æ–π –∏ —Ç–∞–∫–∂–µ –±–æ–ª–µ–µ –∞–¥–∞–ø—Ç–∏—Ä—É–µ–º–æ–π.
 
–î–ª—è —É–º–µ–Ω—å—à–µ–Ω–∏—è —Å–≤—è–∑–Ω–æ—Å—Ç–∏ –æ–±—ä–µ–∫—Ç–æ–≤ —Å–∏—Å—Ç–µ–º—ã, —Å–∞–º–∏ –æ–±—ä–µ–∫—Ç—ã –∑–∞–º–µ–Ω—è—é—Ç—Å—è –Ω–∞ –Ω–µ–∫–æ—Ç–æ—Ä—ã–µ –∞–±—Å—Ç—Ä–∞–∫—Ç–Ω—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏. –¢–µ–º –Ω–µ –º–µ–Ω–µ–µ –æ—Å—Ç–∞–µ—Ç—Å—è –ø—Ä–æ–±–ª–µ–º–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–æ–¥–æ–±–Ω—ã–º–∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—è–º–∏, –æ—Å–æ–±–µ–Ω–Ω–æ –µ—Å–ª–∏ —ç—Ç–æ –∫–∞—Å–∞–µ—Ç—Å—è –±–æ–ª—å—à–∏—Ö –ø—Ä–æ–≥—Ä–∞–º–º–Ω—ã—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π.

–í–Ω–µ–¥—Ä–µ–Ω–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π —è–≤–ª—è–µ—Ç—Å—è –æ–¥–Ω–æ–π –∏–∑ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–π –∫–æ–Ω—Ü–µ–ø—Ü–∏–∏ `InversionOfControl`.
–ò–Ω–≤–µ—Ä—Å–∏—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–æ–¥—Ä–∞–∑—É–º–µ–≤–∞–µ—Ç, —á—Ç–æ –ø–æ—Ç–æ–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –ø—Ä–æ–≥—Ä–∞–º–º—ã —É–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –Ω–µ –ø—Ä–∏–∫–ª–∞–¥–Ω—ã–º –∫–æ–¥–æ–º, –∞ –∫–æ–¥–æ–º —Ñ—Ä–µ–π–º–≤–æ—Ä–∫–∞. –í –æ–±—ã—á–Ω–æ–π –ø—Ä–æ–≥—Ä–∞–º–º–µ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Å—Ç —Å–∞–º —Ä–µ—à–∞–µ—Ç,
–≤ –∫–∞–∫–æ–π –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –¥–µ–ª–∞—Ç—å –≤—ã–∑–æ–≤—ã –ø—Ä–æ—Ü–µ–¥—É—Ä. –ù–æ –µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ñ—Ä–µ–π–º–≤–æ—Ä–∫, –ø—Ä–æ–≥—Ä–∞–º–º–∏—Å—Ç –º–æ–∂–µ—Ç —Ä–∞–∑–º–µ—Å—Ç–∏—Ç—å —Å–≤–æ–π –∫–æ–¥ –≤ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã—Ö —Ç–æ—á–∫–∞—Ö –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è, –∑–∞—Ç–µ–º –∑–∞–ø—É—Å—Ç–∏—Ç—å –≥–ª–∞–≤–Ω—É—é —Ñ—É–Ω–∫—Ü–∏—é —Ñ—Ä–µ–π–º–≤–æ—Ä–∫–∞, –∫–æ—Ç–æ—Ä–∞—è –æ–±–µ—Å–ø–µ—á–∏—Ç –≤—Å—ë –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ.

–ù–µ—Ä–µ–¥–∫–æ –¥–ª—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π –≤ —Ç–∞–∫–∏—Ö —Å–∏—Å—Ç–µ–º–∞—Ö –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã `IoC (Inversion of Control)`. –¢–∞–∫–∏–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã —Å–ª—É–∂–∞—Ç —Å–≤–æ–µ–≥–æ —Ä–æ–¥–∞ —Ñ–∞–±—Ä–∏–∫–∞–º–∏, –∫–æ—Ç–æ—Ä—ã–µ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é—Ç —Å–≤—è–∑—å –º–µ–∂–¥—É –∞–±—Å—Ç—Ä–∞–∫—Ü–∏—è–º–∏ –∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–º–∏
–æ–±—ä–µ–∫—Ç–∞–º–∏ –∏ —Ç–∞–∫–∂–µ –∫–∞–∫ –ø—Ä–∞–≤–∏–ª–æ, —É–ø—Ä–∞–≤–ª—è—é—Ç –ø—Ä–æ—Ü–µ—Å—Å–æ–º —Å–æ–∑–¥–∞–Ω–∏–µ–º —ç—Ç–∏—Ö –æ–±—ä–µ–∫—Ç–æ–≤.

[[[üü°InversionOfControl]]]

–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–æ–º `AspNetCore` –≤ —ç—Ç–æ–º –æ—Ç–Ω–æ—à–µ–Ω–∏–∏ —è–≤–ª—è–µ—Ç—Å—è —Ç–æ, —á—Ç–æ —Ñ—Ä–µ–π–º–≤–æ—Ä–∫ —É–∂–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –∏–º–µ–µ—Ç –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –≤–Ω–µ–¥—Ä–µ–Ω–∏—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π, –∫–æ—Ç–æ—Ä—ã–π –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–º `IServiceProvider`. C–∞–º–∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –µ—â–µ –Ω–∞–∑—ã–≤–∞—é—Ç—Å—è —Å–µ—Ä–≤–∏—Å–∞–º–∏, —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–æ –ø–æ—ç—Ç–æ–º—É –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –º–æ–∂–Ω–æ –Ω–∞–∑–≤–∞—Ç—å –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–º —Å–µ—Ä–≤–∏—Å–æ–≤. –≠—Ç–æ—Ç –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –æ—Ç–≤–µ—á–∞–µ—Ç –∑–∞ —Å–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π —Å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–º–∏ —Ç–∏–ø–∞–º–∏ –∏ –∑–∞ –≤–Ω–µ–¥—Ä–µ–Ω–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π.

```c#
WebApplicationBuilder builder = WebApplication.CreateBuilder();
IServiceCollection allServices = builder.Services;  // IServiceProvider
```

C–µ—Ä–≤–∏—Å –≤ –∫–æ–ª–ª–µ–∫—Ü–∏–∏ `IServiceCollection` –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç –æ–±—ä–µ–∫—Ç¬†`ServiceDescriptor`,
–∫–æ—Ç–æ—Ä—ã–π —Å–æ–¥–µ—Ä–∂–∏—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ–± –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ, —Ç–∏–ø–µ –∏ –∂–∏–∑–Ω–µ–Ω–Ω–æ–º —Ü–∏–∫–ª–µ —Å–µ—Ä–≤–∏—Å–∞.

```C#
foreach (var svc in builder.Services)
{
	var type = svc.ServiceType;
	var impType = svc.ImplementationType;
	var lifeTime = svc.Lifetime;
}
```

---

–ö—Ä–æ–º–µ —Ä—è–¥–∞ –ø–æ–¥–∫–ª—é—á–∞–µ–º—ã—Ö –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é —Å–µ—Ä–≤–∏—Å–æ–≤ –∏–º–µ–µ—Ç—Å—è –µ—â–µ —Ä—è–¥ –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã—Ö
—Å–µ—Ä–≤–∏—Å–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ –º—ã –º–æ–∂–µ–º –ø–æ–¥–∫–ª—é—á–∞—Ç—å –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏.

–í—Å–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–Ω—ã–µ —Å–µ—Ä–≤–∏—Å—ã, —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É—é—Ç—Å—è –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Å –ø–æ–º–æ—â—å—é –º–µ—Ç–æ–¥–æ–≤ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ `IServiceCollection`, –∏–º–µ—é—â–∏—Ö —Ñ–æ—Ä–º—É¬†`Add[Name]()`.

```c#
var builder = WebApplication.CreateBuilder();
builder.Services.AddMvc();
```

–ü–æ—Å–ª–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Å–µ—Ä–≤–∏—Å–∞ –µ–≥–æ –º–æ–∂–Ω–æ –ø–æ–ª—É—á–∏—Ç—å –≤ –ª—é–±–æ–π —á–∞—Å—Ç–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è. –î–ª—è
–ø–æ–ª—É—á–µ–Ω–∏—è —Å–µ—Ä–≤–∏—Å–∞ –º–æ–≥—É—Ç –ø—Ä–∏–º–µ–Ω—è—Ç—å—Å—è —Ä–∞–∑–ª–∏—á–Ω—ã–µ —Å–ø–æ—Å–æ–±—ã –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Å–∏—Ç—É–∞—Ü–∏–∏.
–ù–∞–ø—Ä–∏–º–µ—Ä –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å–≤–æ–π—Å—Ç–≤–æ¬†`Services` –æ–±—ä–µ–∫—Ç–∞ `WebApplication`, –∫–æ—Ç–æ—Ä–æ–µ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –ø—Ä–æ–≤–∞–π–¥–µ—Ä —Å–µ—Ä–≤–∏—Å–æ–≤ –æ–±—ä–µ–∫—Ç¬†`IServiceProvider`. –ß–µ—Ä–µ–∑ –≤–Ω–µ–¥—Ä–µ–Ω–∏–µ –≤ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä –∫–ª–∞—Å—Å–∞ —Å–µ—Ä–≤–∏—Å–∞ –∏–ª–∏ –º–µ—Ç–æ–¥ `Invoke` —É –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞ –∏–ª–∏ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä. –ß–µ—Ä–µ–∑ —Å–≤–æ–π—Å—Ç–≤–æ `RequestServices` —É –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –∑–∞–ø—Ä–æ—Å–∞. –ß–µ—Ä–µ–∑ –∫–ª–∞—Å—Å `WebApplicationBuilder`.

–î–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Å–µ—Ä–≤–∏—Å–∞ —É –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞ —Å–µ—Ä–≤–∏—Å–∞ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –æ–±–æ–±—â–µ–Ω–Ω—ã–π –º–µ—Ç–æ–¥
`GetService()` –∏–ª–∏ `GetRequiredService()`, –∫–æ—Ç–æ—Ä—ã–µ —Ç–∏–ø–∏–∑–∏—Ä—É—é—Ç—Å—è —Ç–∏–ø–æ–º —Å–µ—Ä–≤–∏—Å–∞.

```c#
var some1 = app.Services.GetService<SomeService1>();
var some2 = app.Services.GetRequiredService<SomeService2>();
```

–ü–∞—Ç—Ç–µ—Ä–Ω –ø–æ–ª—É—á–µ–Ω–∏—è —Å–µ—Ä–≤–∏—Å–æ–≤ —á–µ—Ä–µ–∑ `IServiceProvider` –µ—â–µ –Ω–∞–∑—ã–≤–∞–µ—Ç—Å—è¬†`Servicelocator`
–∏ –∫–∞–∫ –ø—Ä–∞–≤–∏–ª–æ, —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥—Ä—É–≥–∏–µ —Å–ø–æ—Å–æ–±—ã, –Ω–æ —Ç–µ–º –Ω–µ –º–µ–Ω–µ–µ –≤ —Ä–∞–º–∫–∞—Ö `AspNetCore` –≤ –ø—Ä–∏–Ω—Ü–∏–ø–µ –º—ã –º–æ–∂–µ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø–æ–¥–æ–±–Ω—É—é —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å –æ—Å–æ–±–µ–Ω–Ω–æ –∫–æ–≥–¥–∞ —Ç—Ä–µ–±—É–µ—Ç—Å—è –≤–Ω–µ–¥—Ä–∏—Ç—å —Å–µ—Ä–≤–∏—Å —Å –±–æ–ª–µ–µ –∫–æ—Ä–æ—Ç–∫–∏–º –∂–∏–∑–Ω–µ–Ω–Ω—ã–º —Ü–∏–∫–ª–æ–º –≤ –¥—Ä—É–≥–æ–π —Å–µ—Ä–≤–∏—Å.

---

–°–∏—Å—Ç–µ–º–∞ –ø–æ–∑–≤–æ–ª—è–µ—Ç —É–ø—Ä–∞–≤–ª—è—Ç—å –∂–∏–∑–Ω–µ–Ω–Ω—ã–º —Ü–∏–∫–ª–æ–º –≤–Ω–µ–¥—Ä—è–µ–º—ã—Ö –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ —Å–µ—Ä–≤–∏—Å–æ–≤.
–° —Ç–æ—á–∫–∏ –∑—Ä–µ–Ω–∏—è –∂–∏–∑–Ω–µ–Ω–Ω–æ–≥–æ —Ü–∏–∫–ª–∞ —Å–µ—Ä–≤–∏—Å—ã –º–æ–≥—É—Ç –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è—Ç—å –æ–¥–∏–Ω –∏–∑ —Ç–∏–ø–æ–≤:

**==Transient==**. –ñ–∏–∑–Ω–µ–Ω–Ω—ã–π —Ü–∏–∫–ª –ø—Ä–∏ –∫–æ—Ç–æ—Ä–æ–º, –ø—Ä–∏ –∫–∞–∂–¥–æ–º –æ–±—Ä–∞—â–µ–Ω–∏–∏ –∫ —Å–µ—Ä–≤–∏—Å—É —Å–æ–∑–¥–∞–µ—Ç—Å—è –Ω–æ–≤—ã–π –æ–±—ä–µ–∫—Ç —Å–µ—Ä–≤–∏—Å–∞. –í —Ç–µ—á–µ–Ω–∏–µ –æ–¥–Ω–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞ –º–æ–∂–µ—Ç –±—ã—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –æ–±—Ä–∞—â–µ–Ω–∏–π –∫ —Å–µ—Ä–≤–∏—Å—É, —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ –ø—Ä–∏ –∫–∞–∂–¥–æ–º –æ–±—Ä–∞—â–µ–Ω–∏–∏ –±—É–¥–µ—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å—Å—è –Ω–æ–≤—ã–π —ç–∫–∑–µ–º–ø–ª—è—Ä —Å–µ—Ä–≤–∏—Å–∞. 

```c#
builder.Services.AddTransient<ICounter, RandomCounter>();
```

**==Scoped==**. –î–ª—è –∫–∞–∂–¥–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞ —Å–æ–∑–¥–∞–µ—Ç—Å—è —Å–≤–æ–π –æ–±—ä–µ–∫—Ç —Å–µ—Ä–≤–∏—Å–∞. –ï—Å–ª–∏ –≤ —Ç–µ—á–µ–Ω–∏–µ –æ–¥–Ω–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞ –µ—Å—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –æ–±—Ä–∞—â–µ–Ω–∏–π –∫ —Å–µ—Ä–≤–∏—Å—É, —Ç–æ –±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –æ–¥–∏–Ω –∏ —Ç–æ—Ç –∂–µ –æ–±—ä–µ–∫—Ç —Å–µ—Ä–≤–∏—Å–∞.

```c#
builder.Services.AddScoped<ICounter, RandomCounter>();
```

**==Singleton==**. –¢–∞–∫–æ–π –æ–±—ä–µ–∫—Ç —Å–µ—Ä–≤–∏—Å–∞ —Å–æ–∑–¥–∞–µ—Ç—Å—è –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –æ–±—Ä–∞—â–µ–Ω–∏–∏ –∫ –Ω–µ–º—É, –≤—Å–µ 
–ø–æ—Å–ª–µ–¥—É—é—â–∏–µ –∑–∞–ø—Ä–æ—Å—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç –æ–¥–∏–Ω –∏ —Ç–æ—Ç –∂–µ —Ä–∞–Ω–µ–µ —Å–æ–∑–¥–∞–Ω–Ω—ã–π –æ–±—ä–µ–∫—Ç —Å–µ—Ä–≤–∏—Å–∞.

```c#
builder.Services.AddSingleton<ICounter, RandomCounter>();
```

–í–Ω–µ–¥—Ä—è—Ç—å —Å–µ—Ä–≤–∏—Å—ã —á–µ—Ä–µ–∑ –º–µ—Ö–∞–Ω–∏–∑–º `DI` –º–æ–∂–Ω–æ —Ç–æ–ª—å–∫–æ —Å —É–≤–µ–ª–∏—á–µ–Ω–Ω—ã–º –∏–ª–∏ —Ç–∞–∫–∏–º –∂–µ –∂–∏–∑–Ω–µ–Ω–Ω—ã–º —Ü–∏–∫–ª–æ–º, –≤–Ω–µ–¥—Ä–µ–Ω–∏–µ –≤ –æ–±—Ä–∞—Ç–Ω–æ–º –ø–æ—Ä—è–¥–∫–µ –≤–æ–∑–º–æ–∂–Ω–æ —Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ —Å–µ—Ä–≤–∏—Å–Ω—ã–π –ª–æ–∫–∞—Ç–æ—Ä, —Ç–æ –µ—Å—Ç—å —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –≤–Ω–µ–¥—Ä–µ–Ω–∏–µ `IServiceProvider` –∏ –≤—ã–∑–æ–≤ `CreateScope()`. 

```c#
builder.Services.AddSingleton<ISingletonWithScoped, SingletonWithScoped>();
builder.Services.AddScoped<IScopedService, ScopedService>();

public class SingletonWithScoped : ISingletonWithScoped
{
    private readonly IServiceProvider _serviceProvider;
    
    public SingletonWithScoped(IServiceProvider serviceProvider)
    {
        _serviceProvider = serviceProvider;
    }

    public void DoWork()
    {
        using (var scope = _serviceProvider.CreateScope())
        {
            var scopedService = scope.ServiceProvider
	            .GetRequiredService<IScopedService>();
            scopedService.PerformAction();
        }
    }
}
```

---

–ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –ø—Ä–∏ –≤–Ω–µ–¥—Ä–µ–Ω–∏–∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π –≤ `AspNetCore` –æ–¥–Ω–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å —Å–æ–ø–æ—Å—Ç–∞–≤–ª—è–µ—Ç—Å—è —Å –æ–¥–Ω–∏–º —Ç–∏–ø–æ–º. –û–¥–Ω–∞–∫–æ –±—ã–≤–∞—é—Ç —Å–∏—Ç—É–∞—Ü–∏–∏, –∫–æ–≥–¥–∞ —Ç—Ä–µ–±—É–µ—Ç—Å—è –æ—Ç–æ–π—Ç–∏ –æ—Ç —ç—Ç–æ–π –ø—Ä–∏–≤—è–∑–∫–∏ –æ–¥–∏–Ω –∫ –æ–¥–Ω–æ–º—É. –ü–µ—Ä–≤–∞—è —Å–∏—Ç—É–∞—Ü–∏—è: –¥–ª—è –æ–¥–Ω–æ–π –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å —Å—Ä–∞–∑—É –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–π. –ê —Ç–∞–∫–∂–µ –∫–æ–≥–¥–∞ –¥–ª—è –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π –Ω—É–∂–µ–Ω –æ–¥–∏–Ω –æ–±—ä–µ–∫—Ç.

–ü—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –ø–æ–¥ –æ–¥–Ω–æ–π –∞–±—Å—Ç—Ä–∞–∫—Ü–∏–µ–π –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–π —Å–µ—Ä–≤–∏—Å–∞, 
–∫–æ–ª–ª–µ–∫—Ü–∏—é —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–π –º–æ–∂–Ω–æ –ø–æ–ª—É—á–∏—Ç—å —á–µ—Ä–µ–∑ –≤–Ω–µ–¥—Ä–µ–Ω–∏–µ `IEnumerable<IType>`.

```c#
builder.Services.AddTransient<IHelloService, RuHelloService>();
builder.Services.AddTransient<IHelloService, EnHelloService>();

////
public HelloMiddleware(RequestDelegate _, IEnumerable<IHelloService> hs)
{
	this.helloServices = helloServices;
}
```

–í –æ–±—Ä–∞—Ç–Ω–æ–π —Å–∏—Ç—É–∞—Ü–∏–∏, –∫–æ–≥–¥–∞ –¥–ª—è –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –∞–±—Å—Ç—Ä–∞–∫—Ü–∏–π –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∞ –æ–¥–Ω–∞ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è, –ø–æ–ª—É—á–µ–Ω–∏–µ —Å–µ—Ä–≤–∏—Å–∞ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç —á–µ—Ä–µ–∑ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –º–µ—Ö–∞–Ω–∏–∑–º –≤–Ω–µ–¥—Ä–µ–Ω–∏—è –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞. –ù–æ —Å—Ç–æ–∏—Ç —É—á–∏—Ç—ã–≤–∞—Ç—å, —á—Ç–æ –ø—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö —Å–µ—Ä–≤–∏—Å–æ–≤ –∫–∞–∫ `Singleton`, –¥–ª—è –∫–∞–∂–¥–æ–π –∞–±—Å—Ç—Ä–∞–∫—Ü–∏–∏ –±—É–¥–µ—Ç —Å–æ–∑–¥–∞–Ω —Å–≤–æ–π –æ–±—ä–µ–∫—Ç —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏. –î–∞–Ω–Ω—É—é –ø—Ä–æ–±–ª–µ–º—É –º–æ–∂–Ω–æ –æ–±–æ–π—Ç–∏ 
–ø–µ—Ä–µ–¥–∞–≤ —É–∂–µ —Å–æ–∑–¥–∞–Ω–Ω—ã–π –æ–±—ä–µ–∫—Ç –∫–∞–∫ –ø–∞—Ä–∞–º–µ—Ç—Ä –≤ –º–µ—Ç–æ–¥ `AddSingleton()`. 

```c#
builder.Services.AddSingleton<IGenerator, ValueStorage>();  // –î–≤–∞ Singleton
builder.Services.AddSingleton<IReader, ValueStorage>();
```

```c#
builder.Services.AddSingleton<ValueStorage>();              // –û–¥–∏–Ω Singleton
builder.Services.AddSingleton<IGenerator>(serv =>  
			serv.GetRequiredService<ValueStorage>());
builder.Services.AddSingleton<IReader>(serv => 
			serv.GetRequiredService<ValueStorage>());
```

[[AspNetCore/üü°Base|üü°Base]]

