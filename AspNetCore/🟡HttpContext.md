–í `AspNetCore` –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞ —Å–æ–∑–¥–∞—ë—Ç—Å—è —ç–∫–∑–µ–º–ø–ª—è—Ä –∫–ª–∞—Å—Å–∞ `HttpContext`.
–û–Ω –∏–Ω–∫–∞–ø—Å—É–ª–∏—Ä—É–µ—Ç –≤—Å—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –≤—Ö–æ–¥—è—â–µ–º –∑–∞–ø—Ä–æ—Å–µ –∏ –ø–æ–∑–≤–æ–ª—è–µ—Ç —É–ø—Ä–∞–≤–ª—è—Ç—å —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ–º –æ—Ç–≤–µ—Ç–∞. –ö–æ–Ω—Ç–µ–∫—Å—Ç –ø–µ—Ä–µ–¥–∞—ë—Ç—Å—è –ø–æ —Ü–µ–ø–æ—á–∫–µ `middleware` –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏
—á–µ—Ä–µ–∑ –¥–µ–ª–µ–≥–∞—Ç `RequestDelegate`. –¢–∞–∫–∂–µ —ç–∫–∑–µ–º–ø–ª—è—Ä –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –º–æ–∂–Ω–æ –ø–æ–ª—É—á–∏—Ç—å —á–µ—Ä–µ–∑ `DI`.

**==Connection==**. –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ–±—ä–µ–∫—Ç `HttpConnectionInfo`, –∫–æ—Ç–æ—Ä—ã–π –∏–Ω–∫–∞–ø—Å—É–ª–∏—Ä—É–µ—Ç –¥–µ—Ç–∞–ª–∏ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è: `IP` –∞–¥—Ä–µ—Å –∫–ª–∏–µ–Ω—Ç–∞, –ø–æ—Ä—Ç—ã, –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ `TLS`. –≠—Ç–æ –±—ã–≤–∞–µ—Ç –ø–æ–ª–µ–∑–Ω–æ, –Ω–∞–ø—Ä–∏–º–µ—Ä, —á—Ç–æ–±—ã –ª–æ–≥–∏—Ä–æ–≤–∞—Ç—å –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—è –∏–ª–∏ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `IP` —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—é.

```c#
var isSecure = context.Connection.ClientCertificate != null;
var remoteIp = context.Connection.RemoteIpAddress;    // IPAddress
var localIp = context.Connection.LocalIpAddress;      // IPAddress
var remotePort = context.Connection.RemotePort;       // int
var localPort  = context.Connection.LocalPort;        // int
```

**==Features==**. C–æ–¥–µ—Ä–∂–∏—Ç –Ω–∏–∑–∫–æ—É—Ä–æ–≤–Ω–µ–≤—ã–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã –¥–ª—è —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–µ–π `HTTP` –æ–±—Ä–∞–±–æ—Ç–∫–∏. –ß–µ—Ä–µ–∑ –Ω–µ—ë –º–æ–∂–Ω–æ –ø–æ–ª—É—á–∏—Ç—å, —Å–∫–∞–∂–µ–º, –ø–æ–¥–¥–µ—Ä–∂–∫—É `WebSockets` –∏–ª–∏ `HTTP/2 Push`. –ö–∞–∂–¥—ã–π `middleware` –∏–º–µ–µ—Ç –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –¥–æ–±–∞–≤–∏—Ç—å –∏–ª–∏ –ø—Ä–æ—á–∏—Ç–∞—Ç—å —ç–ª–µ–º–µ–Ω—Ç –∏–∑ —ç—Ç–æ–π –∫–æ–ª–ª–µ–∫—Ü–∏–∏.

–ú–µ—Ö–∞–Ω–∏–∑–º –º–æ–∂–µ—Ç –≤—ã–≥–ª—è–¥–µ—Ç—å —Ç–∞–∫: `middleware` –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –∫–æ–Ω—Ç–µ–∫—Å—Ç, –Ω–∞ –æ—Å–Ω–æ–≤–µ –µ–≥–æ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ —Å–æ–∑–¥–∞–µ—Ç –Ω–µ–∫–æ—Ç–æ—Ä—ã–π —ç–∫–∑–µ–º–ø–ª—è—Ä –∫–ª–∞—Å—Å–∞, –∑–∞—Ç–µ–º —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç —ç—Ç–æ—Ç —ç–∫–∑–µ–º–ø–ª—è—Ä –≤ –∫–æ–ª–ª–µ–∫—Ü–∏—é `Features` —á–µ—Ä–µ–∑ –º–µ—Ç–æ–¥ `Set<T>(T? instance)`, –∑–∞—Ç–µ–º –¥—Ä—É–≥–∏–µ `middleware` –º–æ–≥—É—Ç —É–∂–µ –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –ø–æ–ª—É—á–∏—Ç—å —ç–∫–∑–µ–º–ø–ª—è—Ä —ç—Ç–æ–≥–æ –∫–ª–∞—Å—Å–∞ —á–µ—Ä–µ–∑ –º–µ—Ç–æ–¥ `Features.Get<T>()`.

```c#
var webSocketFeature    = context.Features.Get<IHttpWebSocketFeature>(); 
var bodyControl         = context.Features.Get<IHttpBodyControlFeature>();
var authFeature         = context.Features.Get<IHttpAuthenticationFeature>();
var lifetime            = context.Features.Get<IHttpRequestLifetimeFeature>();
var sendFile            = context.Features.Get<IHttpSendFileFeature>();
var maxSizeFeature      = context.Features.Get<IHttpMaxRequestBodySizeFeature>();
var upgradeFeature      = context.Features.Get<IHttpUpgradeFeature>();
var tlsFeature          = context.Features.Get<ITlsHandshakeFeature>();
```

**==Items==**. –°–≤–æ–π—Å—Ç–≤–æ `Items` –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç —Å–ª–æ–≤–∞—Ä—å `IDictionary<object,object?>` –¥–ª—è –æ–±–º–µ–Ω–∞ –¥–∞–Ω–Ω—ã–º–∏ –º–µ–∂–¥—É —Ä–∞–∑–Ω—ã–º–∏ —É—Ä–æ–≤–Ω—è–º–∏ `middleware` –≤ —Ä–∞–º–∫–∞—Ö –æ–¥–Ω–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞. –≠—Ç–æ —É–¥–æ–±–Ω–æ, –∫–æ–≥–¥–∞ –Ω—É–∂–Ω–æ, –Ω–∞–ø—Ä–∏–º–µ—Ä, –∑–∞—Å–µ—á—å –≤—Ä–µ–º—è –Ω–∞—á–∞–ª–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∏ –ø–µ—Ä–µ–¥–∞—Ç—å –µ–≥–æ –¥–∞–ª—å—à–µ –¥–ª—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è.


```c#
context.Items["data"] = 100;
var data = (int)context.Items["data"];
```

**==RequestServices==**. –ß–µ—Ä–µ–∑ `RequestServices` –¥–æ—Å—Ç—É–ø–µ–Ω –ª–æ–∫–∞–ª—å–Ω—ã–π –ø—Ä–æ–≤–∞–π–¥–µ—Ä –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π `IServiceProvider`, –∫–æ—Ç–æ—Ä—ã–π –ø–æ–∑–≤–æ–ª—è–µ—Ç –∫–∞–∂–¥–æ–º—É `middleware` –∏–ª–∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—É –ø–æ–ª—É—á–∏—Ç—å –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Å–µ—Ä–≤–∏—Å—ã. –≠—Ç–æ —Ü–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π –º–µ—Ö–∞–Ω–∏–∑–º –≤–Ω–µ–¥—Ä–µ–Ω–∏—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π.


```c#
var service1 = context.RequestServices.GetService<SomeType1>();
var service2 = context.RequestServices.GetRequiredService<SomeType2>();
```

**==TraceIdentifier==**. –°–≤–æ–π—Å—Ç–≤–æ `TraceIdentifier` –≤—ã–¥–∞—ë—Ç —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞ `GUID`, –∫–æ—Ç–æ—Ä—ã–π —É–¥–æ–±–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤ –ª–æ–≥–∞—Ö –∏ —Ç—Ä–∞—Å—Å–∏—Ä–æ–≤–∫–µ. –ê —Å –ø–æ–º–æ—â—å—é `User`  –º–æ–∂–Ω–æ —Ä–∞–±–æ—Ç–∞—Ç—å —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ–± –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω–æ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ: –ø—Ä–æ–≤–µ—Ä—è—Ç—å —Ä–æ–ª–∏, –∏–∑–≤–ª–µ–∫–∞—Ç—å –∫–ª–∞–π–º—ã.

```c#
var guid = context.TraceIdentifier;
```

**==Session==**. –°–≤–æ–π—Å—Ç–≤–æ `Session` –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –¥–æ—Å—Ç—É–ø –∫ –æ–±—ä–µ–∫—Ç—É `ISession`, –≤ –∫–æ—Ç–æ—Ä–æ–º –º–æ–∂–Ω–æ —Ö—Ä–∞–Ω–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ –º–µ–∂–¥—É –∑–∞–ø—Ä–æ—Å–∞–º–∏. –ü–µ—Ä–µ–¥ —Ç–µ–º –∫–∞–∫ —Ä–∞–±–æ—Ç–∞—Ç—å —Å —Å–µ—Å—Å–∏—è–º–∏, –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –ø–æ–¥–∫–ª—é—á–∏—Ç—å `middleware` –≤—ã–∑–æ–≤–æ–º `app.UseSession()` –∏ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å —Ö—Ä–∞–Ω–∏–ª–∏—â–µ –≤ –ø–∞–º—è—Ç–∏ –∏–ª–∏ `Redis` —á–µ—Ä–µ–∑ –º–µ—Ç–æ–¥ `services.AddDistributedMemoryCache()`.

```c#
context.Session.SetString("CartId", cartId);
var cartId = context.Session.GetString("CartId");
```

–°–µ—Å—Å–∏—è –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç –º–µ—Ö–∞–Ω–∏–∑–º —Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –Ω–∞ —Å—Ç–æ—Ä–æ–Ω–µ —Å–µ—Ä–≤–µ—Ä–∞ –º–µ–∂–¥—É –∑–∞–ø—Ä–æ—Å–∞–º–∏ –æ–¥–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è. –ö–ª–∏–µ–Ω—Ç –ø–æ–ª—É—á–∞–µ—Ç —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä —Å–µ—Å—Å–∏–∏ `SessionID` –∏ —Ö—Ä–∞–Ω–∏—Ç –µ–≥–æ –≤ –≤–∏–¥–µ `cookie`, –∏ –ø—Ä–∏ –∫–∞–∂–¥–æ–º –∑–∞–ø—Ä–æ—Å–µ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –µ–≥–æ –æ–±—Ä–∞—Ç–Ω–æ. –ù–∞ –æ—Å–Ω–æ–≤–µ –Ω–µ–≥–æ —Å–µ—Ä–≤–µ—Ä –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –Ω–∞–±–æ—Ä –ø–∞—Ä –∫–ª—é—á –∑–Ω–∞—á–µ–Ω–∏–µ, –∞—Å—Å–æ—Ü–∏–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º.

–î–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Å–µ—Å—Å–∏–π –Ω—É–∂–Ω–æ —Å–Ω–∞—á–∞–ª–∞ –ø–æ–¥–∫–ª—é—á–∏—Ç—å –∫–∞–∫–∏–µ-–Ω–∏–±—É–¥—å —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ —Å–µ—Ä–≤–∏—Å–æ–≤ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–≥–æ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞, –∑–∞—Ç–µ–º –ø–æ–¥–∫–ª—é—á–∏—Ç—å —Å–µ—Ä–≤–∏—Å—ã —Å–µ—Å—Å–∏–π —á–µ—Ä–µ–∑ –º–µ—Ç–æ–¥ `AddSession`, –∑–∞—Ç–µ–º –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å `middleware` –≤ –∫–æ–Ω–≤–µ–π–µ—Ä–µ –º–µ–∂–¥—É `UseRouting` –∏ `UseEndpoints`.

–ü–æ —É–º–æ–ª—á–∞–Ω–∏—é `AspNetCore` —Ö—Ä–∞–Ω–∏—Ç –¥–∞–Ω–Ω—ã–µ –≤ –ø–∞–º—è—Ç–∏ —Å–µ—Ä–≤–µ—Ä–Ω–æ–≥–æ –ø—Ä–æ—Ü–µ—Å—Å–∞ `MemoryCache`.
–ù–æ –ø—Ä–∏ –∂–µ–ª–∞–Ω–∏–∏ –µ–≥–æ –º–æ–∂–Ω–æ —Å–º–µ–Ω–∏—Ç—å. –ß–∞—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑—É—é—Ç —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ:

```C#
// MemoryCache
services.AddDistributedMemoryCache();

// Redis
services.AddStackExchangeRedisCache(options =>
{
    options.Configuration = "localhost:6379";
    options.InstanceName = "MyApp:";
});

// SqlServer
services.AddDistributedSqlServerCache(options =>
{
    options.ConnectionString = "...";
    options.SchemaName = "dbo";
    options.TableName   = "Sessions";
});
```

```c#
services.AddSession(options =>
{
    options.Cookie.Name = ".MyApp.Session";      // –∏–º—è cookie
    options.Cookie.HttpOnly = true;              // –∑–∞–ø—Ä–µ—â–∞–µ–º –¥–æ—Å—Ç—É–ø –∏–∑ JS
    options.Cookie.IsEssential = true;           // –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –¥–∞–∂–µ –ø—Ä–∏ GDPR-–æ—Ç–∫–ª.
    options.IdleTimeout = TimeSpan.FromMinutes(20); // –≤—Ä–µ–º—è –∂–∏–∑–Ω–∏ —Å–µ—Å—Å–∏–∏
    options.Cookie.SecurePolicy = CookieSecurePolicy.Always; // –ø–æ HTTPS
});
```

```c#
app.UseRouting();
app.UseSession();
app.UseEndpoints(ep =>{});
```

**==WebSockets==**. –ü—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π –º–µ–Ω–µ–¥–∂–µ—Ä `WebSocket` —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π. –° –µ–≥–æ –ø–æ–º–æ—â—å—é –º–æ–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å, –ø—Ä–∏—à—ë–ª –ª–∏ –∑–∞–ø—Ä–æ—Å –Ω–∞ `WebSocket` —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ, –∏ –ø—Ä–∏ —Ç–∞–∫–∂–µ –≤—ã–ø–æ–ª–Ω–∏—Ç—å –ø–µ—Ä–µ–≤–æ–¥ —Ç–µ–∫—É—â–µ–≥–æ `HTTP` —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è –≤ –¥–≤—É–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–π –∫–∞–Ω–∞–ª –æ–±–º–µ–Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏—è–º–∏.

```c#
if (context.WebSockets.IsWebSocketRequest)
{
    var webSocket = await context.WebSockets.AcceptWebSocketAsync();
}
```

**==Response==**. –ß–µ—Ä–µ–∑ —Å–≤–æ–π—Å—Ç–≤–æ `Response`, –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–Ω–æ–µ —Ç–∏–ø–æ–º `HtttpResponse`, 
–ø–æ–∑–≤–æ–ª—è–µ—Ç —É–ø—Ä–∞–≤–ª—è—Ç—å –æ—Ç–≤–µ—Ç–æ–º, –∫–æ—Ç–æ—Ä—ã–π –±—É–¥–µ—Ç –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω –æ–±—Ä–∞—Ç–Ω–æ –∫–ª–∏–µ–Ω—Ç—É.

```c#
app.Run(async (context) =>
{
    await context.Response.WriteAsync(request.PathBase);
});
```

**==Request==**. –°–≤–æ–π—Å—Ç–≤–æ `Request` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ–±—ä–µ–∫—Ç `HttpRequest`, –≤ –∫–æ—Ç–æ—Ä–æ–º —Å–æ–¥–µ—Ä–∂–∞—Ç—Å—è –≤—Å–µ –¥–∞–Ω–Ω—ã–µ –≤—Ö–æ–¥—è—â–µ–≥–æ –∑–∞–ø—Ä–æ—Å–∞: –ø–æ—Ç–æ–∫ —Ç–µ–ª–∞, –∑–∞–≥–æ–ª–æ–≤–∫–∏, –∫—É–∫–∏, –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∑–∞–ø—Ä–æ—Å–∞ –∏ —Ç–∞–∫ –¥–∞–ª–µ–µ.

```c#
app.Run(async (context) =>
{
    var request = context.Request;
    await context.Response.WriteAsync(request.PathBase);
});
```

[[HttpRequest]]
[[HttpResponse]]
[[AspNetCore/üü°Base|üü°Base]]

