Платформа `AspNetCore (Active Server Pages)` представляет технологию для создания веб приложений на платформе `DotNet`, развиваемую компанией `Microsoft`. В качестве языков программирования для разработки приложений на `AspNetCore` используются `C#` и `F#`.

История `AspNetCore` началась с выходом первой версии `DotNet` в начале `2002` года и с 
тех пор `AspNetCore` и `DotNet` развивались параллельно: c новой версией `DotNet` выходила 
и новая версия `AspNetCore`. Изначально `AspNet` была нацелена на работу в `Windows` на
веб сервере `IIS`, хотя благодаря `Mono` приложения  можно было запускать и на `Linux`.

Однако в `2014` году `Microsoft` взяла курс на развитии `AspNet` как кроссплатформенной технологии, которая развивается как `opensource` проект. Новая обновленная платформа получила название `AspNetCore` и вышла в релиз в `2016` году. Теперь она стала работать
на `Windows`, `MacOS` и `Linux`. Она стала более легковесной и получила модульность.

![[Pasted image 20231208225523.png]]

Архитектура `AspNetCore` модульная и многоуровневая. На самом верхнем уровне располагаются различные модели взаимодействия с пользователем. Это технологии построения пользовательского интерфейса и обработки ввода пользователя. К ним относятся классические модели `MVC` и `RazorPages`, `SPA`, а также `Blazor`. Также на
том уровне располагаются различные сервисы, обеспечивающие обмен данными. 

Все механизмы первого слоя опираются на ядро платформы, представленное механизмы
для реализации `middleware` и набора сервисов. Конвейер `middleware` последовательно обрабатывают входящие запросы и позволяют внедрять в них написанные сервисы.

Кроме того, технологии высшего уровня также взаимодействуют с различными расширениями, которые не являются непосредственной частью `AspNetCore`,
в них входят расширения для логгирования, конфигурации и так далее.

Уровень `middleware` приложения опирается на слой веб сервера: `Kestrel`, `IIS`, `HTTP.sys`. Именно сервер обеспечивает приём и маршрутизацию сетевых обращений к конвейеру.
Сервер `Kestrel` является кроссплатформенным и оптимизирован в плане  потребления памяти и скорости работы. Веб сервер `IIS` позволяющий запускать приложение под управлением службы `InternetInformationServices`. Сервер `HTTP.sys` основан на внутренней библиотеке `HTTP.sys`, как и `IIS` доступен только системе `Windows`.

---

Приложение представляет объект `AspNetCore.Builder.WebApplication`. Этот объект настраивает всю конфигурацию приложения, его маршруты, зависимости и т.д.

Для создания объекта `WebApplication` необходим специальный класс-строитель `WebApplicationBuilder`. Он создается через статический метод `CreateBuilder` приложения. В качестве параметра в метод передаются аргументы, которые передаются приложению при запуске в виде ключевого слова `args`.

`WebApplicationBuilder` используется для: Установки конфигурации приложения,
Добавления сервисов Настройка логгирования в приложении, Установки окружения приложения, Конфигурации объектов` IHostBuilder` и `IWebHostBuilder`.

**WebApplicationBuilder** - класс для настройки и создания приложения.
**WebApplication.CreateBuilder()** - создание объекта WebApplicationBuilder.

```c# 
var builder = WebApplication.CreateBuilder(args);
var app = builder.Build();
app.Run();
```

Для конфигурирования приложения в экземпляре объекта `WebApplicationBuilder` определяются следующие свойства:

**Configuration** - применяется для добавления конфигурации к приложению.
**Environment** - предоставляет информацию об окружении приложения.
**Host** - объект IHostBuilder, который применяется для настройки хоста.
**Logging** - позволяет определить настройки логгирования в приложении.
**Services** - представляет коллекцию сервисов и позволяет регистрировать сервисы.
**WebHost** - объект IWebHostBuilder, который позволяет настроить параметры сервера.

---

**WebApplication** - класс представляющий серверное приложение.
**WebApplicationBuilder.Build()** - создание объекта WebApplication,

Класс `WebApplication` применяется для управления обработкой запроса, установки маршрутов, получения сервисов. Класс `WebApplication` применяет три интерфейса:

**IHost** - применяется для запуска и остановки хоста, слушающего входящие запросы.
**IApplicationBuilder** - применяется для установки компонентов обработки запроса.
**IEndpointRouteBuilder** - применяется для установки сопоставленных маршрутов.

Для получения доступа к функциональности приложения можно использовать следующие свойства класса `WebApplication`:

**Configuration** - представляет конфигурацию приложения в виде объекта IConfiguration.
**Environment** - представляет окружение приложения в виде `IWebHostEnvironment`.
**Lifetime** - позволяет получать уведомления о событиях жизненного цикла приложения.
**Logger** - представляет логгер приложения по умолчанию.
**Services** - представляет зарегистрированные сервисы приложения.
**Urls** - представляет набор адресов, которые использует сервер.

Для управления хостом класс `WebApplication` определяет следующие методы:

**Run()/Start()** - запускает приложение, блокируя поток выполнения.
**RunAsync()/StartAsync()** - запускает приложение в асинхронном режиме.
**StopAsync()** - останавливает выполнение приложение с возвратом управления.