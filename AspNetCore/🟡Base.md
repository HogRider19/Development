Платформа `AspNetCore (Active Server Pages)` представляет технологию для создания веб приложений на платформе `DotNet`, развиваемую компанией `Microsoft`. В качестве языков программирования для разработки приложений на `AspNetCore` используются `C#` и `F#`.

История `AspNetCore` началась с выходом первой версии `DotNet` в начале `2002` года и с 
тех пор `AspNetCore` и `DotNet` развивались параллельно: c новой версией `DotNet` выходила 
и новая версия `AspNetCore`. Изначально `AspNet` была нацелена на работу в `Windows` на
веб сервере `IIS`, хотя благодаря `Mono` приложения  можно было запускать и на `Linux`.

Однако в `2014` году `Microsoft` взяла курс на развитии `AspNet` как кроссплатформенной технологии, которая развивается как `opensource` проект. Новая обновленная платформа получила название `AspNetCore` и вышла в релиз в `2016` году. Теперь она стала работать
на `Windows`, `MacOS` и `Linux`. Она стала более легковесной и получила модульность.

![[Pasted image 20231208225523.png]]

Архитектура `AspNetCore` модульная и многоуровневая. На самом верхнем уровне располагаются различные модели взаимодействия с пользователем. Это технологии построения пользовательского интерфейса и обработки ввода пользователя. К ним относятся классические модели `MVC` и `RazorPages`, `SPA`, а также `Blazor`. Также на
том уровне располагаются различные сервисы, обеспечивающие обмен данными. 

Все механизмы первого слоя опираются на ядро платформы, представленное механизмы
для реализации `middleware` и набора сервисов. Конвейер `middleware` последовательно обрабатывают входящие запросы и позволяют внедрять в них написанные сервисы.

Кроме того, технологии высшего уровня также взаимодействуют с различными расширениями, которые не являются непосредственной частью `AspNetCore`,
в них входят расширения для логгирования, конфигурации и так далее.

Уровень `middleware` приложения опирается на слой веб сервера: `Kestrel`, `IIS`, `HTTP.sys`. Именно сервер обеспечивает приём и маршрутизацию сетевых обращений к конвейеру.
Сервер `Kestrel` является кроссплатформенным и оптимизирован в плане  потребления памяти и скорости работы. Веб сервер `IIS` позволяющий запускать приложение под управлением службы `InternetInformationServices`. Сервер `HTTP.sys` основан на внутренней библиотеке `HTTP.sys`, как и `IIS` доступен только системе `Windows`.

| Версия           | Год       | Ключевые особенности                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| ---------------- | --------- | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| ASP.NET 1.0-4.8  | 2002-2019 | ✅ Web Forms (серверный рендеринг, ViewState, PostBack)                  ✅ ASP.NET MVC (четкое разделение Model-View-Controller)                   ✅ ASP.NET Web API (создание REST API)                                                    ✅ SignalR (соединения)                                                                               ✅ Зависимость от IIS и Windows                                                              ✅ Работает на .NET Framework                                        |
| ASP.NET Core 1.0 | 2016      | ✅ Полностью переписан                                                                        ✅ Кроссплатформенность (Windows, Linux, macOS)                             ✅ Встроенный Dependency Injection                                                        ✅ Middleware-архитектура                                                                       ✅ Поддержка .NET Core и .NET Framework                                             ⚠️ Ограниченный функционал в сравнении с ASP.NET MVC/Web API |
| ASP.NET Core 2.0 | 2017      | ✅ Введение Razor Pages (упрощение создания страниц)                        ✅ Объединение MVC и Web API                                                             ✅ Встроенная поддержка Identity                                                             ✅ Улучшенный DI и конфигурация                                                           ✅ Поддержка Tag Helpers                                                                            ✅ Поддержка Kestrel как самостоятельного веб-сервера |
| ASP.NET Core 3.1 | 2019      | ✅ LTS (долгосрочная поддержка)                                                            ✅ Blazor Server (C# для фронтенда)                                                           ✅ Удалена поддержка .NET Framework (только .NET Core)                       ✅ Поддержка gRPC                                                                                  ✅ Улучшена производительность                                                             ✅ Улучшение работы с SPA (Angular, React)        |
| ASP.NET 5.0      | 2020      | ✅ Объединение .NET Core и .NET Framework в единую платформу   ✅ Улучшенная производительность и минимизация                              ✅ Улучшение Blazor (WebAssembly)                                                          ✅ Улучшенная работа с контейнерами                                                      ⚠️ Не является LTS                                                                                                                                                                   |
| ASP.NET 6.0      | 2021      | ✅ LTS (долгосрочная поддержка)                                                           ✅ Минималистичные API для быстрого создания REST                       ✅ Hot Reload (горячая перезагрузка)                                                     ✅ Улучшена интеграция с Blazor                                                            ✅ Упрощённый стартовый шаблон                                                          ✅ Улучшена производительность                                          |
| ASP.NET 7.0      | 2022      | ✅ Blazor Hybrid                                                                                          ✅ Расширение возможностей Minimal APIs                                             ✅ Улучшение производительности HTTP/3 и gRPC                                  ✅ Улучшение облачной интеграции                                                         ✅ Новые возможности для тестирования и модульной архитектуры                                                                                  |
| ASP.NET 8.0      | 2023      | ✅ LTS (долгосрочная поддержка)                                                             ✅ Полная поддержка Blazor WebAssembly без JavaScript                       ✅ Улучшенная контейнеризация и оптимизация образов Docker          ✅ Интеграция с облачными сервисами Azure                                         ✅ Поддержка Native AOT (ускоренная компиляция)                           ✅ Улучшение Hot Reload                                                                                       |
В `AspNetCore` до версии `.NET 6` ключевую роль в инициализации и конфигурации приложения играл специальный класс `Startup`. Этот класс был центральной точкой, в которой происходила настройка всех компонентов приложения: регистрация сервисов, конфигурация `middleware`, маршрутизация и обработка окружений. Структура `Startup` включала два основных специальных метода: `ConfigureServices` и `Configure`.

В методе `ConfigureServices` происходила регистрация всех зависимостей, которые приложение будет использовать через встроенный контейнер `DI`. Здесь подключались
базы данных, сервисы, аутентификация, авторизация и другие необходимые для работы компоненты. В методе `Configure` настраивался `HTTP` конвейер обработки запросов, задавался порядок обработки `middleware`, настраивались маршруты, обрабатывалась работа с ошибками и применялись глобальные политики настройки безопасности.

Однако с выходом 6 версии `Microsoft` предложила новый минималистичный подход, при котором необходимость в отдельном классе `Startup` отпала. Конфигурация приложения стала максимально компактной и сосредоточилась в одном стартовом файле `Program.cs`. 

Несмотря на это, возможность использовать `Startup` сохранилась она полностью поддерживается и работает как раньше. Это позволяет разработчикам, привыкшим к классическому стилю, или тем, кто продолжать использовать знакомую архитектуру.

```c#
public class Startup
{
    private readonly IConfiguration _configuration;
    
    public Startup(IConfiguration configuration)
    {
        _configuration = configuration;
    }
    
    public void ConfigureServices(IServiceCollection services)
    {
        services.AddControllers();
    }
    
    public void Configure(IApplicationBuilder app, IWebHostEnvironment env)
    {
        if (env.IsDevelopment())
        {
            app.UseDeveloperExceptionPage();
        }
        
        app.UseRouting();
        
        app.UseEndpoints(endpoints =>
        {
            endpoints.MapControllers();
        });
    }
}
```

```c#
var builder = WebApplication.CreateBuilder(args);
var startup = new Startup(builder.Configuration);
startup.ConfigureServices(builder.Services);

var app = builder.Build();
startup.Configure(app, app.Environment);
app.Run();
```