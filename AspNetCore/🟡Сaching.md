–ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç —Å–æ–±–æ–π –º–µ—Ö–∞–Ω–∏–∑–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –≤ –æ—Ç–µ–ª—å–Ω–æ–º –º–µ—Å—Ç–µ –¥–ª—è –±–æ–ª–µ–µ –±—ã—Å—Ç—Ä–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞ –∫ –Ω–∏–º –≤ –±—É–¥—É—â–µ–º. –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –º–æ–∂–µ—Ç –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ –ø–æ–≤—ã—Å–∏—Ç—å –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è, —É–º–µ–Ω—å—à–∞—è –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ–±—Ä–∞—â–µ–Ω–∏–π –∫ –∏—Å—Ç–æ—á–Ω–∏–∫–∞–º –¥–∞–Ω–Ω—ã—Ö.

==**PreCaching**==. –ü—É—Ç–µ–º –∞–Ω–∞–ª–∏–∑–∞ —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –Ω–∞–∏–±–æ–ª–µ–µ —á–∞—Å—Ç–æ –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ–º—ã–µ –∏–ª–∏ –¥–∞–Ω–Ω—ã–µ, –∫–æ—Ç–æ—Ä—ã–µ –º–æ–≥—É—Ç —Å–Ω–∏–∑–∏—Ç—å –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è. –≠—Ç–∏ –¥–∞–Ω–Ω—ã–µ –∫—ç—à–∏—Ä—É—é—Ç—Å—è –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è. –ó–∞—Ç–µ–º –ø–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞, –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –±–µ—Ä–µ—Ç —ç—Ç–∏ –¥–∞–Ω–Ω—ã–µ –∏–∑ –∫—ç—à–∞ –≤–º–µ—Å—Ç–æ –∑–∞–ø—Ä–∞—à–∏–≤–∞–Ω–∏—è –∏–∑ –≤–Ω–µ—à–Ω–µ–≥–æ –∏—Å—Ç–æ—á–Ω–∏–∫–∞. –ú–∏–Ω—É—Å —ç—Ç–æ–≥–æ –ø–æ–¥—Ö–æ–¥–∞ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç—å —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ —Å –≤–Ω–µ—à–Ω–∏–º –∏—Å—Ç–æ—á–Ω–∏–∫–æ–º –¥–∞–Ω–Ω—ã—Ö, –æ—Å–æ–±–µ–Ω–Ω–æ –∫–æ–≥–¥–∞ —Ä–∞–±–æ—Ç–∞—é—Ç —Ä–∞–∑–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤.

**==OnDemandCaching==**. –ö–æ–≥–¥–∞ –¥–∞–Ω–Ω—ã–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã, –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Å–Ω–∞—á–∞–ª–∞ –æ–±—Ä–∞—â–∞–µ—Ç—Å—è –≤ –∫—ç—à, –µ—Å–ª–∏ –∫—ç—à–µ –Ω–∞–π–¥–µ–Ω—ã —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–µ –¥–∞–Ω–Ω—ã–µ, —Ç–æ –æ–Ω–∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è —ç—Ç–æ –Ω–∞–∑—ã–≤–∞–µ—Ç—Å—è¬†`–°acheHit`. –ï—Å–ª–∏ –¥–∞–Ω–Ω—ã–µ –≤ –∫—ç—à–µ –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç —ç—Ç–æ –Ω–∞–∑—ã–≤–∞–µ—Ç—Å—è¬†`CacheMiss`, —Ç–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∏–∑–≤–ª–µ–∫–∞–µ—Ç –∏–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –∏ –∫—ç—à–∏—Ä—É—é—Ç –¥–ª—è –ø–æ—Å–ª–µ–¥—É—é—â–∏—Ö –∑–∞–ø—Ä–æ—Å–æ–≤. –ú–∏–Ω—É—Å —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç—å –¥–µ–ª–∞—Ç—å –∑–∞–ø—Ä–æ—Å –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö, –∫–æ—Ç–æ—Ä—ã–π —Å–Ω–∏–∂–∞–µ—Ç –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∏—Ç–æ–≥–æ–≤–æ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.

---

–°–∞–º—ã–º –ø—Ä–æ—Å—Ç—ã–º —Å–ø–æ—Å–æ–±–æ–º –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è –≤ `AspNetCore` –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –æ–±—ä–µ–∫—Ç–∞¬†`Memory.IMemoryCache`, –∫–æ—Ç–æ—Ä—ã–π –ø–æ–∑–≤–æ–ª—è–µ—Ç —Å–æ—Ö—Ä–∞–Ω—è—Ç—å –¥–∞–Ω–Ω—ã–µ –≤ –∫—ç—à–µ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ. –ü—Ä–∏–º–µ–Ω—è—è –º–µ—Ç–æ–¥—ã –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ `IMemoryCache`, –º—ã –º–æ–∂–µ–º —É–ø—Ä–∞–≤–ª—è—Ç—å —Å–∏—Å—Ç–µ–º–æ–π –∫—ç—à–∞ –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏. 

```c#
public interface IMemoryCache : IDisposable
{
	// –î–æ–±–∞–≤–ª—è–µ—Ç –≤ –∫—ç—à –∏–ª–∏ –ø–µ—Ä–µ–∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç –∑–∞–ø–∏—Å—å —Å key.
	ICacheEntry CreateEntry(object key);
	
	// –¥–æ–±–∞–≤–ª—è–µ—Ç –≤ –∫—ç—à —ç–ª–µ–º–µ–Ω—Ç, –ø—Ä–∏–º–µ–Ω—è—è –æ–ø—Ü–∏–∏ MemoryCacheEntryOptions
	object Set(object key, object value, MemoryCacheEntryOptions options)
	
	// –ü—ã—Ç–∞–µ—Ç—Å—è –ø–æ–ª—É—á–∏—Ç—å —ç–ª–µ–º–µ–Ω—Ç –ø–æ –∫–ª—é—á—É key.
	bool TryGetValue(object key, out object? value);
	
	// –£–¥–∞–ª—è–µ—Ç –∏–∑ –∫—ç—à–∞ —ç–ª–µ–º–µ–Ω—Ç –ø–æ –∫–ª—é—á—É key
	void Remove(object key);
}
```

–ü–ª–∞—Ç—Ñ–æ—Ä–º–∞ `AspNetCore` –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –≤—Å—Ç—Ä–æ–µ–Ω–Ω—É—é —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ `IMemoryCache` 
–≤ –≤–∏–¥–µ¬†`MemoryCache`, –∫–æ—Ç–æ—Ä—ã–π –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∫–∞–∫ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –¥–ª—è —Å–µ—Ä–≤–∏—Å–∞ `IMemoryCache` –∏ –∫–æ—Ç–æ—Ä—ã–π –∏–Ω–∫–∞–ø—Å—É–ª–∏—Ä—É–µ—Ç –≤—Å–µ –æ–±—ä–µ–∫—Ç—ã –∫—ç—à–∞ –≤ –≤–∏–¥–µ —Å–ª–æ–≤–∞—Ä—è `Dictionary`.

–ß—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å —Å–µ—Ä–≤–∏—Å `IMemoryCache` –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –µ–≥–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –¥–æ–±–∞–≤–∏—Ç—å –≤ –∫–æ–ª–ª–µ–∫—Ü–∏—é —Å–µ—Ä–≤–∏—Å–æ–≤ —Å –ø–æ–º–æ—â—å—é `AddMemoryCache()`. –ü–æ —Å—É—Ç–∏ —ç—Ç–æ—Ç —Å–µ—Ä–≤–∏—Å —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –¥–ª—è –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ `IMemoryCache`, —Å–æ–ø–æ—Å—Ç–∞–≤–ª—è—è –µ–≥–æ —á–µ—Ä–µ–∑ —Å–∏–Ω–≥–ª—Ç–æ–Ω c –æ–±—ä–µ–∫—Ç–æ–º —Ç–∏–ø–∞ `MemoryCache`.


```c#
builder.Services.AddMemoryCache();

app.Map("/", (IMemoryCache cache) =>  
{  
	cache.Set("Key", "Value", new MemoryCacheEntryOptions()
		.SetAbsoluteExpiration(TimeSpan.FromMinutes(5)));
});
```

–î–ª—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è –≤ –º–µ—Ç–æ–¥¬†`Set()`¬†–≤ –∫–∞—á–µ—Å—Ç–≤–µ —Ç—Ä–µ—Ç—å–µ–≥–æ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞ –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è –æ–±—ä–µ–∫—Ç¬†`MemoryCacheEntryOptions`, –∫–æ—Ç–æ—Ä—ã–π —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç —Ä—è–¥ –Ω–∞—Å—Ç—Ä–æ–µ–∫.

```c#
var cacheOptions = new MemoryCacheEntryOptions
{
    // –ê–±—Å–æ–ª—é—Ç–Ω–æ–µ –≤—Ä–µ–º—è –∏—Å—Ç–µ—á–µ–Ω–∏—è (–∫–æ–Ω–∫—Ä–µ—Ç–Ω–∞—è –¥–∞—Ç–∞/–≤—Ä–µ–º—è)
    AbsoluteExpiration = DateTimeOffset.Now.AddHours(2),
    
    // –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞: –∞–±—Å–æ–ª—é—Ç–Ω–æ–µ –≤—Ä–µ–º—è –∏—Å—Ç–µ—á–µ–Ω–∏—è –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ —Ç–µ–∫—É—â–µ–≥–æ –º–æ–º–µ–Ω—Ç–∞
    AbsoluteExpirationRelativeToNow = TimeSpan.FromHours(1),
    
    // –°–∫–æ–ª—å–∑—è—â–µ–µ –≤—Ä–µ–º—è –∏—Å—Ç–µ—á–µ–Ω–∏—è (—Å–±—Ä–∞—Å—ã–≤–∞–µ—Ç—Å—è –ø—Ä–∏ –∫–∞–∂–¥–æ–º –æ–±—Ä–∞—â–µ–Ω–∏–∏)
    SlidingExpiration = TimeSpan.FromMinutes(15),
    
    // –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è
    Priority = CacheItemPriority.High,
    
    // –†–∞–∑–º–µ—Ä —ç–ª–µ–º–µ–Ω—Ç–∞ –≤ –∫—ç—à–µ (–¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫—ç—à–µ–º –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ä–∞–∑–º–µ—Ä–∞)
    Size = 1024,
    
    // –¢–æ–∫–µ–Ω—ã –∏–∑–º–µ–Ω–µ–Ω–∏—è (–¥–ª—è –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–≥–æ —É–¥–∞–ª–µ–Ω–∏—è –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö)
    ExpirationTokens = {
        new CancellationChangeToken(
	        new CancellationTokenSource(TimeSpan.FromMinutes(30)).Token)
    },
    
    // –ö–æ–ª–ª–±—ç–∫–∏ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –∏–∑ –∫—ç—à–∞
    PostEvictionCallbacks = {
        new PostEvictionCallbackRegistration
        {
            EvictionCallback = (key, value, reason, state) => 
                Console.WriteLine($"–≠–ª–µ–º–µ–Ω—Ç {key} —É–¥–∞–ª–µ–Ω. –ü—Ä–∏—á–∏–Ω–∞: {reason}"),
            State = null
        }
    }
};

// –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –æ–ø—Ü–∏–π –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –≤ –∫—ç—à
_memoryCache.Set("cache_key", "cache_value", cacheOptions);
```

---

–û–¥–Ω—É –∏–∑ —Ñ–æ—Ä–º —Ñ–æ—Ä–º –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–µ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ. –ü—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç –º–µ—Ö–∞–Ω–∏–∑–º –æ–±—â–µ–≥–æ –∫–µ—à–∞ —É –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —Å–µ—Ä–≤–µ—Ä–æ–≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π. –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã–π –∫—ç—à –æ–±–ª–∞–¥–∞–µ—Ç —Ç–∞–∫–∏–º–∏ –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞–º–∏, –∫–∞–∫ —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö –º–µ–∂–¥—É –∑–∞–ø—Ä–æ—Å–∞–º–∏ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —Ä–∞–∑–Ω—ã—Ö —Å–µ—Ä–≤–µ—Ä–æ–≤, –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –æ—Ç –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è, –∑–∞–ø—É—Å–∫–∞, –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞ –∏ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è, –æ—Ç—Å—É—Ç—Å—Ç–≤–∏—è –≤–ª–∏—è–Ω–∏—è –Ω–∞ –ª–æ–∫–∞–ª—å–Ω—É—é –ø–∞–º—è—Ç—å. –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–≥–æ –∫—ç—à–∞ –º–æ–∂–µ—Ç –ø–æ–≤—ã—Å–∏—Ç—å –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∏ –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å —Å–µ—Ä–≤–µ—Ä–Ω–æ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è `AspNetCore`.

–í `C#` —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã–π –∫—ç—à –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–º¬†`IDistributedCache`.
–î–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫—ç—à–µ–º —ç—Ç–æ—Ç —Ç–∏–ø –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç —Ä—è–¥ –º–µ—Ç–æ–¥–æ–≤. –°–∞–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –≤—ã–≥–ª—è–¥–∏—Ç —Ç–∞–∫:

```c#
public interface IDistributedCache
{
	byte[]? Get(string key);
	void Set(string key, byte[] value, DistributedCacheEntryOptions options);
	
	Task<byte[]?> GetAsync(string key, CancellationToken token);
	Task SetAsync(string key,byte[] value, DistributedCacheEntryOptions options,
	  CancellationToken token);
	  
	void Remove(string key);
	Task RemoveAsync(string key, CancellationToken token);
	
	void Refresh(string key);
	Task RefreshAsync(string key, CancellationToken token));
}
```

–ò–∑ –ø–µ—Ä–µ—á–∏—Å–ª–µ–Ω–∏—è –º–µ—Ç–æ–¥–æ–≤ –≤–∏–¥–Ω–æ, —á—Ç–æ –º—ã –º–æ–∂–µ–º —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ –∫—ç—à –¥–∞–Ω–Ω—ã–µ –ª–∏–±–æ –≤ –≤–∏–¥–µ –º–∞—Å—Å–∏–≤–∞ –±–∞–π—Ç `byte[]`, –ª–∏–±–æ –≤ –≤–∏–¥–µ —Å—Ç—Ä–æ–∫–∏ `string`. –ò –æ–±—Ä–∞—Ç–Ω–æ –ø–æ–ª—É—á–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –∏–∑ –∫—ç—à–∞ —Ç–∞–∫–∂–µ –º–æ–∂–Ω–æ —Ç–æ–ª—å–∫–æ –≤ –≤–∏–¥–µ –æ–±—ä–µ–∫—Ç–æ–≤¬†`byte[]`¬†–∏¬†`string`. –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ –µ—Å–ª–∏ –Ω–∞—à–∏ –¥–∞–Ω–Ω—ã–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è—é—Ç –¥—Ä—É–≥–æ–π —Ç–∏–ø, —Ç–æ –Ω–∞–º –ø–æ–Ω–∞–¥–æ–±–∏—Ç—å—Å—è –º–µ—Ö–∞–Ω–∏–∑–º —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –∏ –¥–µ—Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏–∏.

```c#
// –î–æ–±–∞–≤–ª–µ–Ω–∏–µ Redis
builder.Services.AddStackExchangeRedisCache(options => {
    options.Configuration = "localhost";
    options.InstanceName = "local";
});
```

---

–ö–æ–º–ø—Ä–µ—Å—Å–∏—è –∏–ª–∏ —Å–∂–∞—Ç–∏–µ –æ—Ç–≤–µ—Ç–∞ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç –æ–¥–∏–Ω –∏–∑ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ –ø–æ–∑–≤–æ–ª—è—é—Ç —É–º–µ–Ω—å—à–∏—Ç—å –æ–±—ä–µ–º –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º—ã—Ö –∫–ª–∏–µ–Ω—Ç—É –¥–∞–Ω–Ω—ã—Ö –±–µ–∑ –ø–æ—Ç–µ—Ä–∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è —Å–∞–º–∏—Ö –¥–∞–Ω–Ω—ã—Ö.

–î–ª—è –∫–æ–º–ø—Ä–µ—Å—Å–∏–∏ –æ—Ç–≤–µ—Ç–∞ –≤ —Ä–∞–º–∫–∞—Ö `AspNetCore` –º—ã –º–æ–∂–µ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ª–∏–±–æ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ —Å—Ä–µ–¥—Å—Ç–≤–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –≤–µ–±-—Å–µ—Ä–≤–µ—Ä–∞: `DynamicCompressionModule` –≤ `IIS`, –º–æ–¥—É–ª—å `mod_deflate` –≤ `Apache` –∏–ª–∏ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –∫–æ–º–ø—Ä–µ—Å—Å–∏–∏ –≤ `Nginx`. –û–¥–Ω–∞–∫–æ —ç—Ç–∏ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –Ω–µ –≤—Å–µ–≥–¥–∞ –±—ã–≤–∞—é—Ç –¥–æ—Å—Ç—É–ø–Ω—ã, –æ—Å–æ–±–µ–Ω–Ω–æ –∫–æ–≥–¥–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–∞–ø—Ä—è–º—É—é —Ö–æ—Å—Ç–∏—Ç—Å—è –≤ —Ä–∞–º–∫–∞—Ö —Ç–∞–∫–∏—Ö –≤–µ–± —Å–µ—Ä–≤–µ—Ä–æ–≤ –∫–∞–∫ `HTTP.sys` –∏–ª–∏ `Kestrel`. –¢–æ–≥–¥–∞ –º—ã –º–æ–∂–µ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–º `ResponseCompression`. 

```c#
var builder = WebApplication.CreateBuilder(args);
 
builder.Services.AddResponseCompression(
	options => options.EnableForHttps = true);
 
var app = builder.Build();
 
app.UseResponseCompression();
app.MapGet("/", () => "Hello, world!");
app.Run();
```

–°–ª–µ–¥—É–µ—Ç —É—á–∏—Ç—ã–≤–∞—Ç—å, —á—Ç–æ –¥–ª—è –ø—Ä–æ—Ç–æ–∫–æ–ª–∞ `HTTPS` –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –æ—Ç–∫–ª—é—á–µ–Ω–æ —Å–∂–∞—Ç–∏–µ, –ø–æ—ç—Ç–æ–º—É –≤ –≤—ã–∑–æ–≤–µ –¥–∞–Ω–Ω–æ–≥–æ –º–µ—Ç–æ–¥–∞ –ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è —Å–∂–∞—Ç–∏–µ –∏ –¥–ª—è `HTTPS`. –ù–∞ —É—Ä–æ–≤–Ω–µ –ø—Ä–æ—Ç–æ–∫–æ–ª–∞ `HTTP` —ç—Ç–æ –≤—ã—Ä–∞–∂–∞–µ—Ç—Å—è —Ç–∞–∫–∂–µ –≤ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–∏ –∑–∞–≥–æ–ª–æ–≤–∫–∞¬†`content-encoding`, –∫–æ—Ç–æ—Ä—ã–π —Å–µ—Ä–≤–µ—Ä –≤–º–µ—Å—Ç–µ —Å –æ—Ç–≤–µ—Ç–æ–º –ø–æ—Å—ã–ª–∞–µ—Ç –∫–ª–∏–µ–Ω—Ç—É. –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é —ç—Ç–æ—Ç –∑–∞–≥–æ–ª–æ–≤–æ–∫ –∏–º–µ–µ—Ç –∑–Ω–∞—á–µ–Ω–∏–µ¬†`br`, –∫–æ—Ç–æ—Ä—ã–π –≥–æ–≤–æ—Ä–∏—Ç –æ —Ç–æ–º, —á—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Å–∂–∞—Ç–∏–µ –≤ —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç —Å–∂–∞—Ç–∏—è –¥–∞–Ω–Ω—ã—Ö¬†`Brotli`.

–ü—Ä–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –∫–æ–º–ø—Ä–µ—Å—Å–∏–∏ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ –æ—Ç–≤–µ—Ç–∞ –Ω–∞–º –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –Ω–∞–¥–æ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å 
`MIME` —Ç–∏–ø –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º—ã—Ö –¥–∞–Ω–Ω—ã—Ö. –ó–∞–≥–æ–ª–æ–≤–æ–∫ —Ç–∏–ø–∞ –æ—Ç–≤–µ—Ç–∞ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–ª—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ `ResultsApi`,  `MVC` –∏–ª–∏ `RazorPages`. –û–¥–Ω–∞–∫–æ –Ω–µ –≤—Å–µ `middleware` –≤ –∫–æ–Ω–≤–µ–π–µ—Ä–µ `AspNetCore` –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é—Ç –∑–∞–≥–æ–ª–æ–≤–∫–∏. –ù–∞–ø—Ä–∏–º–µ—Ä, –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ –∑–∞–ø—Ä–æ—Å–∞ —Å –ø–æ–º–æ—â—å—é –º–µ—Ç–æ–¥–∞¬†`Run`¬†–∑–∞–≥–æ–ª–æ–≤–∫–∏ –Ω–µ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é—Ç—Å—è, –∏ –∏—Ö –Ω–∞–¥–æ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—Ç—å –≤—Ä—É—á–Ω—É—é.

```c#
builder.Services.AddResponseCompression(
	options => options.EnableForHttps = true);
 
var app = builder.Build();

app.UseResponseCompression();
app.Run(async (context) =>
{
    context.Response.ContentType = "text/plain";
    await context.Response.WriteAsync("Hello, world!");
});
```

---

–ö—Ä–æ–º–µ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –¥–µ–π—Å—Ç–≤–∏–π –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞ –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ —Ä–∞–±–æ—Ç—ã –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –º–æ–∂–Ω–æ –ø—Ä–∏–º–µ–Ω—è—Ç—å –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–æ–≤ —Å—Ç–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –∫–æ–Ω—Ç–µ–Ω—Ç–∞.

–î–ª—è –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏—Ö —Ñ–∞–π–ª–æ–≤ –ø—Ä–∏ –∏—Ö –æ—Ç–ø—Ä–∞–≤–∫–µ —Å–ª–µ–¥—É–µ—Ç —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–µ –∑–∞–≥–æ–ª–æ–≤–∫–∏. –î–ª—è —ç—Ç–æ–≥–æ `StaticFilesMiddleware` –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è –æ–±—ä–µ–∫—Ç¬†`StaticFileOptions`, —É –∫–æ—Ç–æ—Ä–æ–≥–æ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è —Å–≤–æ–π—Å—Ç–≤–æ¬†`OnPrepareResponse`.

–î–ª—è –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏—Ö —Ñ–∞–π–ª–æ–≤ —Å–ª–µ–¥—É–µ—Ç —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–µ –∑–∞–≥–æ–ª–æ–≤–∫–∏.
–î–ª—è —ç—Ç–æ–≥–æ `StaticFilesMiddleware` –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è –æ–±—ä–µ–∫—Ç `StaticFileOptions`, —É –∫–æ—Ç–æ—Ä–æ–≥–æ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è —Å–≤–æ–π—Å—Ç–≤–æ¬†`OnPrepareResponse`, –∏–º–µ—é—â–µ–µ –¥–æ—Å—Ç—É–ø –∫ `Http` –∫–æ–Ω—Ç–µ–∫—Å—Ç—É:

```c#
app.UseStaticFiles(new StaticFileOptions()
{
    OnPrepareResponse = ctx =>
    {
	    ctx.Context.Response.Headers.Add("Cache-Control", "public,max-age=600");
	}
});
```

–°–≤–æ–π—Å—Ç–≤–æ `OnPrepareResponse` –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç –¥–µ–ª–µ–≥–∞—Ç, –∫–æ—Ç–æ—Ä—ã–π –≤ –∫–∞—á–µ—Å—Ç–≤–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞ –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –æ–±—ä–µ–∫—Ç¬†`StaticFileResponseContext`. –ß–µ—Ä–µ–∑ —ç—Ç–æ—Ç –æ–±—ä–µ–∫—Ç –º–æ–∂–Ω–æ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–∞–≥–æ–ª–æ–≤–∫–∏ –æ—Ç–≤–µ—Ç–∞, –∫–æ—Ç–æ—Ä—ã–π –±—É–¥—É—Ç –ø–æ—Å—ã–ª–∞—Ç—å—Å—è –≤–º–µ—Å—Ç–µ —Å–æ —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–º–∏ —Ñ–∞–π–ª–∞–º–∏.

–í –¥–∞–Ω–Ω–æ–º —Å–ª—É—á–∞–µ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è –∑–∞–≥–æ–ª–æ–≤–æ–∫ `Cache-Control`, –∫–æ—Ç–æ—Ä—ã–π  –∑–∞–¥–∞–µ—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è. –ó–Ω–∞—á–µ–Ω–∏–µ `public` —É–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞ –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –±—Ä–∞—É–∑–µ—Ä–∞ –∏ –ø—Ä–æ–∫—Å–∏ —Å–µ—Ä–≤–µ—Ä–æ–≤.
–£ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏—Ö —Ñ–∞–π–ª–æ–≤ –µ—Å—Ç—å –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ–∫: –µ—Å–ª–∏ –º—ã –∏–∑–º–µ–Ω–∏–º —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ñ–∞–π–ª–∞,
—Ç–æ –ø—Ä–∏ –ø–æ–≤—Ç–æ—Ä–Ω–æ–º –æ–±—Ä–∞—â–µ–Ω–∏–∏ –±—Ä–∞—É–∑–µ—Ä –ø—Ä–æ–¥–æ–ª–∂–∏—Ç –∏–∑–≤–ª–µ–∫–∞—Ç—å —É—Å—Ç–∞—Ä–µ–≤—à–∏–µ —Ñ–∞–π–ª—ã –∏–∑ –∫—ç—à–∞.

–î–ª—è —Ä–µ—à–µ–Ω–∏—è —ç—Ç–æ–π –ø—Ä–æ–±–ª–µ–º—ã –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–ª—è—Ç—å –∫ —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–º —Ñ–∞–π–ª–∞–º –≤–µ—Ä—Å–∏–æ–Ω–Ω–æ—Å—Ç—å
–∏ –ø—Ä–∏ –∫–∞–∂–¥–æ–º –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Ñ–∞–π–ª–∞ —Å–µ—Ä–≤–µ—Ä–æ–º —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ –º–µ–Ω—è—Ç—å –≤–µ—Ä—Å–∏—é —Ñ–∞–π–ª–∞:

```html
<link rel="stylesheet" href="/css/site.css?v=123" />
<script src="app.js?v=123"></script>
```

---

–ü–ª–∞—Ç—Ñ–æ—Ä–º–∞ `AspNetCore` –ø–æ–∑–≤–æ–ª—è–µ—Ç –∫—ç—à–∏—Ä–æ–≤–∞—Ç—å –æ—Ç–≤–µ—Ç –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è, –∏ –¥–ª—è —ç—Ç–æ–≥–æ –ø—Ä–∏–º–µ–Ω—è–µ—Ç —Å–µ—Ä–≤–∏—Å `IOutputCacheStore` –∏ —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –∫–æ–Ω–≤–µ–π–µ—Ä–∞ `OutputCacheMiddleware`. 

–î–ª—è –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è –æ—Ç–≤–µ—Ç–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –Ω–∞–º –Ω–∞–¥–æ –ø—Ä–µ–∂–¥–µ –≤—Å–µ–≥–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.
–î–ª—è —ç—Ç–æ–≥–æ —Å–ª–µ–¥—É–µ—Ç –≤—ã–ø–æ–ª–Ω–∏—Ç—å –¥–≤–∞ —à–∞–≥–∞. –ü—Ä–µ–∂–¥–µ –≤—Å–µ–≥–æ, –¥–æ–±–∞–≤–∏—Ç—å –≤ –∫–æ–ª–ª–µ–∫—Ü–∏—é —Å–µ—Ä–≤–∏—Å–æ–≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –≤—Å–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ —Å–µ—Ä–≤–∏—Å—ã –∫–µ—à–∞ —Å –ø–æ–º–æ—â—å—é –º–µ—Ç–æ–¥–∞ `AddOutputCache()`.
–¢–∞–∫–∂–µ –Ω—É–∂–Ω–æ –¥–æ–±–∏—Ç—å –≤ –∫–æ–Ω–≤–µ–π–µ—Ä¬†`OutputCacheMiddleware`¬†—á–µ—Ä–µ–∑¬†`UseOutputCache()`.

```c#
var builder = WebApplication.CreateBuilder(args);
 
builder.Services.AddOutputCache();
var app = builder.Build();
 
app.UseOutputCache();
app.MapGet("/", () => "Hello, world!").CacheOutput();
app.MapGet("/", [CacheOutput] () => "Hello, world!");

app.Run();
```

[[AspNetCore/üü°Base|üü°Base]]
