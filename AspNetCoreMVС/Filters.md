**Фильтры** - сущности, которые позволяют выполнять некоторые действия до или после определенной стадии обработки запроса

## Типы фильтров:

1. **Авторизации:** определяют, авторизован ли пользователь для выполнения текущего запроса. Если пользователь не авторизован для доступа к ресурсу, то фильтр завершает обработку запроса.
2. **Ресурсов:** выполняются после фильтров авторизации. Его метод OnResourceExecuting() выполняется до всех остальных фильтров и до привязки модели, а метод OnResourceExecuted() выполняется после
3. **Действий:** запускается после фильтра ресурсов как до, так и после выполнения метода действия контроллера. Только к действиям
4. **Результатов действий:** фильтр применяется к результатам методов контроллера, выполняется как до, так и после получения результата
5. **Исключений:** определяют действия в необработанных исключений

Вместе все эти типы фильтров образуют конвейер фильтров, который встроен в процесс обработки запроса в MVC и который начинает выполняется после того, как инфраструктура MVC выбрала метод контроллера для обработки запроса. На разных этапах обработки запроса в этом конвейере вызывается соответствующий фильтр

Все фильтры поддерживают два способа реализации: синхронную и асинхронную. В зависимости от выбранного способа класс фильтра будет реализовать тот или иной интерфейс

Синхронные фильтры (за исключением фильтра Razor Page) определяют два метода: On[Stage]Executing и On[Stage]Executed. Метод On[Stage]Executing вызывается непосредственно перед этапом Stage, а метод On[Stage]Executed сразу после завершения этапа [Stage]

Класс фильтра также наследует класс Attribute, так как фильтры реализуются обычно как атрибуты, что упрощает их применение.

Мы можем на любом этапе выйти из этой конвейера, предотвратив выполнение последующих фильтров. Для этого надо установить свойство Result переданного в фильтр контекста

Если фильтр применяется непосредственно к контроллеру или его методу, то установка зависимостей через Dependency Injection не будет работать. Чтобы обойти это ограничение, надо использовать один из классов ServiceFilterAttribute или TypeFilterAttribute. Они представляют из себя атрибуты в конструктор которых нужно передать тип фильтра

 [![](https://yougile.com/user-data/d26b74d6-466b-4220-9c7e-5cd16136c50c/image-preview.png)](https://yougile.com/user-data/d26b74d6-466b-4220-9c7e-5cd16136c50c/image.png)