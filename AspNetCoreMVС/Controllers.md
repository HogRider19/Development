**Контроллер** - основным элементом в архитектуре mvc. При получении запроса система маршрутизации выбирает для обработки запроса нужный контроллер и передает ему данные запроса. Контроллер обрабатывает эти данные и посылает обратно результат обработки

В AspNetCore MVC контроллер представляет обычный класс, который обычно наследуется от класса Microsoft.AspNetCore.Mvc.Controller.

Класс контроллера должен удовлетворять как минимум одному из следующих условий:

1. Класс контроллера имеет суффикс "Controller"
2. Класс контроллера наследуется от класса, с суффиксом "Controller"
3. К классу контроллера применяется атрибут \[Controller]

---

### Действия контроллера

**Действия контроллера** - это публичные методы, которые могут сопоставляться с запросами. Является основной частью контроллера

Сопоставление запроса с контроллером и его действием происходит благодаря системе маршрутизации в Program.cs

Однако не все методы контроллера являются действиями. Контроллер может иметь непубличные методы - такие методы не рассматриваются как действия и соответственно не соотноситься с запросами

**\[Controller]** - указывает, что класс является контроллером
**\[NonController]** - указывает, что класс не является контроллером **\[NonAction]** - указывает, что метод не является действием **\[ActionName]** - переопределяет имя действия

Кроме того, методы могут обслуживать разные типы запросов. Для указания типа запроса нам надо применить к методу один из атрибутов: \[HttpGet], \[HttpPost], \[HttpPut], \[HttpPatch], \[HttpDelete]. Если атрибут не указан, то метод может обрабатывать все типы запросов

---

### Контекст контроллера

При обращении к контроллеру среда создает для него контекст, который содержит связанные с контроллером данные. Для получения контекста в классе контроллера есть свойство ControllerContext, которое представляет одноименный класс ControllerContext

## Свойства ControllerContext:

1. **RouteData:** возвращает данные маршрута
2. **HttpContext:** содержит информацию о контексте запроса
3. **ActionDescriptor:** возвращает дескриптор действия контроллера
4. **ModelState:** возвращает словарь ModelStateDictionary, который используется для валидации данных, отправленных пользователем

## Свойства HttpContext:

1. **Request:** содержит собственно информацию о текущем запросе.
2. **Response:** управляет ответом
3. **User:** представляет текущего пользователя
4. **Session:** объект для работы с сессиями

---

### Результаты действий

**ActionResult** - абстрактный класс результата действия контроллера

**ContentResult** - отправляет в ответ в виде строки **EmptyResult** - отправляет пустой ответ в виде статусного кода 200 **NoContentResult** - отправляет пустой ответ в виде статусного кода 204 **FileResult** - базовый для результатов записи потока данных **FileContentResult:** FileResult, пишет в ответ массив байтов **VirtualFileResult:** FileResult, пишет в ответ массив байтов по пути **FileStreamResult:** FileResult, пишет бинарный поток в выходной ответ **StatusCodeResult:** возвращает клиенту определенный статусный код **UnauthorizedResult**: возвращает клиенту ответ 401 **NotFoundResult:** возвращает клиенту ответ 404 **BadRequestResult:** возвращает клиенту ответ 400 **OkResult:** возвращает клиенту ответ 200 **CreatedResult:** возвращает клиенту ответ 201 **AcceptedResult:** возвращает статусный код 202 **ChallengeResult:** используется для проверки аутентификации **JsonResult:** возвращает в качестве ответа объект в формате JSON **RedirectResult:** возвращает статусный код 301 или 301 **RedirectToActionResult:** выполняет переадресацию на действие **PartialViewResult:** производит рендеринг View в выходной поток **ViewComponentResult:** возвращает в ответ сущность ViewComponent **ViewResult:** производит рендеринг представления и отправляет результаты рендеринга в виде html-страницы клиенту

---

### Переопределение контроллеров

Как правило, для создания контроллера достаточно унаследовать свой класс от базового класса Controller. Однако если нам необходимо, чтобы наши контроллеры реализовали некоторую общую логику, мы можем определить свой базовый класс контроллера и уже от него наследовать остальные контроллеры. Либо мы также можем переопределить некоторые методы базового класса Controller

**OnActionExecuting()** - метод выполняется при вызове метода контроллера до его непосредственного выполнения. В качестве параметра принимает объект типа ActionExecutingContext

**OnActionExecuted()** - метод выполняется после выполнения метода контроллера. В качестве параметра принимает ActionExecutedContext